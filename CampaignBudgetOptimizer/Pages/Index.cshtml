@page
@model CampaignBudgetOptimizer.Pages.IndexModel
@{
    ViewData["Title"] = "Campaign Budget Optimizer";
}

<h2>Calculating optimal ad budget, made easy.</h2>

<form method="post">
    <div>
        <label>Total Campaign Budget (Z):</label>
        <input asp-for="Campaign.TotalAdSpend" type="number" min="0" step="any" required />
        <span asp-validation-for="Campaign.TotalAdSpend" class="text-danger"></span>
    </div>
    <div>
        <label>Agency Fee Percentage (Y1):</label>
        <input asp-for="Campaign.AgencyFeePercentage" type="number" min="0" step="0.01" required />
        <span asp-validation-for="Campaign.AgencyFeePercentage" class="text-danger"></span>
    </div>
    <div>
        <label>Tool Fee Percentage (Y2):</label>
        <input asp-for="Campaign.ToolFeePercentage" type="number" min="0" step="0.01" required />
        <span asp-validation-for="Campaign.ToolFeePercentage" class="text-danger"></span>
    </div>
    <div>
        <label>Fixed Costs for Agency Hours:</label>
        <input asp-for="Campaign.AgencyHours" type="number" min="0" step="any" required />
        <span asp-validation-for="Campaign.AgencyHours" class="text-danger"></span>
    </div>

    <hr />

    <!-- Input fields for adding new ads dynamically -->
    <div>
        <label>Add New Ad:</label>
        <input type="text" id="newAdName" placeholder="Ad Name" />
        <input type="number" id="newAdBudget" placeholder="Budget" min="0" step="any" />
        <button type="button" onclick="addAd()">Add Ad</button>
    </div>

    <hr />

    <!-- List ads dynamically from the Campaign model -->
    @if (Model.Campaign.AdBudgets.Count > 0)
    {
        @foreach (var ad in Model.Campaign.AdBudgets)
        {
            <div>
                <label>@ad.Key Budget:</label>
                <input name="Campaign.AdBudgets[@ad.Key]" value="@ad.Value" type="number" min="0" step="any" />
            </div>
        }
    }

    <button type="submit">Calculate Optimal Budget for New Ad</button>
</form>

<!-- Display optimal budget after calculation -->
<div>
    @if (ViewData["OptimalBudget"] != null)
    {
        <h3>Optimal Budget for New Ad: @ViewData["OptimalBudget"]</h3>
    }
</div>

<!-- JavaScript to dynamically add ads -->
<script>
    function addAd() {
        var adName = document.getElementById('newAdName').value;
        var adBudget = document.getElementById('newAdBudget').value;

        if (adName && adBudget >= 0) { // Ensure adBudget is a positive number
            // Create new input elements for the ad name and budget
            var adDiv = document.createElement('div');
            var adLabel = document.createElement('label');
            var adInput = document.createElement('input');

            adLabel.innerHTML = adName + " Budget:";
            adInput.name = "Campaign.AdBudgets[" + adName + "]";
            adInput.value = adBudget;
            adInput.type = "number";
            adInput.min = "0";
            adInput.step = "any";

            adDiv.appendChild(adLabel);
            adDiv.appendChild(adInput);

            // Find the submit button to insert before it
            var submitButton = document.querySelector('button[type="submit"]');

            // Insert the new ad div before the submit button
            document.forms[0].insertBefore(adDiv, submitButton);

            // Clear input fields for the next ad
            document.getElementById('newAdName').value = '';
            document.getElementById('newAdBudget').value = '';
        } else {
            alert('Please enter a valid positive number for the ad budget.');
        }
    }
</script>
